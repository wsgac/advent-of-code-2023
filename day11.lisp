(in-package #:advent-of-code-2023.day11)

(defun find-empty-rows-and-columns (array)
  "Find empty rows and columns in ARRAY."
  (labels ((empty (c)
	    (char= #\. c)))
    (let* ((rows (length array))
	   (cols (length (first array)))
	   (transposed (transpose array))
	   (empty-rows
	    (loop
	      for r from 0 below rows
	      if (every #'empty (nth r array))
		collect r))
	   (empty-cols
	     (loop
	       for c from 0 below cols
	       if (every #'empty (nth c transposed))
		 collect c)))
      (list empty-rows empty-cols))))

(defun duplicate-rows-and-columns (array rows cols)
  "Duplicate ROWS and COLS in ARRAY. Transpose twice to make row/column
duplication easier."
  (let* ((expanded-rows
	   (loop
	     for r from 0
	     for row in array
	     collect row
	     if (member r rows)
	       collect row))
	 (expanded-cols
	   (loop
	     for c from 0
	     for col in (transpose expanded-rows)
	     collect col
	     if (member c cols)
	       collect col)))
    (transpose expanded-cols)))

(defun find-galaxies (array)
  "Find all galaxies (#\#) within ARRAY and return a list of (row
. column) cons cells."
  (loop
    for r from 0
    for row in array
    nconc (loop
	    for c from 0
	    for item in row
	    if (char= #\# item)
	      collect (cons r c))))

(defun puzzle-1 (&key (input *example-input-1*))
  (labels ((distance (el1 el2)
	     (+ (abs (- (car el2) (car el1)))
		(abs (- (cdr el2) (cdr el1))))))
    (let* ((data (parse-string-into-list input))
		   (empties (find-empty-rows-and-columns data))
		   (expanded (apply #'duplicate-rows-and-columns data empties))
		   (galaxies (find-galaxies expanded)))
	      (loop
		for (el1 . els) on galaxies
		sum (loop
		      for el2 in els
		      sum (distance el1 el2))))))

(defun puzzle-2 (&key (input *example-input-2*))
)

;;;; Data

(defvar *example-input-1*
  "...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....")

(defvar *input-1*
  ".#......................#........................#.........................#................#...............................................
...........................................................................................................#...........#....................
........#...................#.......#............................................#....................#.................................#...
.........................................#............#.........................................#...........................................
....................................................................................................................................#.......
#...........................................................................................................................................
................#......................................................#.............#......................................................
......#..............#.........#......#........................#............................................................................
............#.....................................#......................................#...........................#......................
.....................................................................................................#....................#.................
.....................................................................#.......#............................#......#..............#...........
#...........................................................................................................................................
...................................#.....................................#..................................................................
.........#................#................................#...........................#......#.......................#..................#..
...............#....................................#..........................................................#............................
...........................................#..................................................................................#.............
...............................#...........................................#.......#.................#......................................
#..............................................................#..........................................#.................................
...........#.........................................................#.............................................#........................
......................#...........#...........................................#..........#.....#............................................
........................................................#...............................................................#......#............
...#..........#.........................#................................#..................................................................
............................................................................................................................................
..................#..................................#..............#..................................................................#....
...............................#...........................#...................#.............................#..............................
....................................#....................................................#.............#...............#...................#
................................................................................................#...........................................
.#............#............#........................................................#......................................#................
.......#...................................#........#.......................................................................................
..........................................................#.................................................................................
..............................................................................#..............#.......#................................#.....
.................................#..........................................................................#.........#.....................
....................#....................................................................#......................................#...........
........#...................................#.....................................................................#.........................
#........................#.........................#.............................................#..........................................
.................#.........................................#.........................#......................................................
..............................#.................................#.......................................................................#...
......#...............................#..............................................................................#.............#........
......................................................#..................#.................#............#.......#...........................
..............#...........#......................................................#..........................................................
............................................................#...............................................................................
.....................................................................#......................................................................
.#..................#........................................................................#................................#.............
.........................................#..........................................................................#.......................
.........#.....#..............#..............................................#.........#..............#..............................#.....#
...............................................................................................................#............................
...................................................#...................#...................................................#................
.......................#...........#..............................#......................................#..............................#...
...........#................#...............................................................................................................
...........................................................................#.................................#..............................
................#......................................................................#...........#........................................
.....................................................................................................................#........#......#......
..................................................#.............#..............................#............................................
......#.....#...........#..................#..............................................................#.................................
............................................................................................................................................
...................#...................#..................#....................................................#........................#...
............................................................................................................................................
.........................................................................#..................#...............................................
.....................................................................................................................................#.....#
...................................#...........#....................#.......................................................................
..#.....#.....................................................................#.........................#...................................
...........................#.........................#..................................#..........#..................#.....................
..................................................................................#............................................#............
..............#................#...............................#............................................................................
............................................................................................................................................
.....................................#.........#......................................#..............#........#..........#..................
.....#............#...............................................#........................................................................#
..........................................................................................................#.................................
..........#.............#.....#...........................#.....................#...........................................................
...............................................................#.................................#....................................#.....
....................................#..................................#....................................................................
#......................................................................................................#..........#..........#..............
..........................................#.............................................#...................................................
.................#.............................#........#......................................#.........................#...............#..
......................................#..........................................#..........................................................
............#...............................................#...............................................................................
...........................................................................................#..........................................#.....
.....#................#...............................................................................#.....................................
............................#......................#................#.............................................................#.........
...................................#.........................................................................................#..............
.#.......................................................................#.........#........................#...............................
.........................................#.................#.....................................#...............#..........................
..............................#.............................................................................................................
.................#...............................#.............................#.......#.....#.......#......................................
.......................................................................#....................................................................
............................................................................................................................................
......................................#...........................#.........................................................................
.................................................................................#..........................................................
..................................#.......................#.................................................................................
......................#..............................................#...........................#..........................#.....#.....#...
...........................#............#................................................................#.....#............................
...........................................................................................#................................................
............................................................................................................................................
.........#.........#..........................................................#.............................#.........#.............#.......
...........................................#.............#..................................................................................
............................#..........................................................#..........................#.........................
.......................#.........#..........................................................................................................
......#...........................................#....................#.......................#..........#.................................
...............#.................................................................#..........................................#...............
..........................................................#......#....................................................#............#......#.
......................................................................................................#.....................................
...............................................................................................................#............................
...............................#.....#................#.............................#.......................................................
..#............................................................................#...............#..........................#.................
.......#...................................#........................................................#.......................................
..............................................................#........#.....................................#..............................
...........................#.......#..............#......................................................................................#..
......................#......................................................................................................#......#.......
..............#...........................................................................................#.............#...................
..........................................................#.........#.........................#.............................................
.......................................#.......#...............................#..............................#.............................
................................#...................................................#.......................................................
#..........................................#........#..........#............................................................................
...........................................................................#............#.........................#..................#......
............#...........................................................................................#...................................
...................................#........................................................#...............................................
........................#.................................#......#.......................................................#..................
........#................................................................#..................................................................
...................#..............................#.................................#..............#.........#.....#.............#..........
..........................................#...................#........................................................................#....
.........................................................................................................#..................................
..............................#.........................................................#...................................................
.#..............#...........................................................................................................................
...................................#...........#........................................................................#...................
.........#...............................#........................................................................................#.........
....................#........................................................................#.....................#.........#............#.
..............................................................................#.......................#.......#.............................
.................................#.......................#...............#...............#..................................................
............................................................................................................................................
............................#........#......................................................................................................
......................#........................................#................#...........#..............#........................#.......
.....#.......#........................................................................#..........#........................................#.
..................................................#.........................................................................................
...............................................................................................................#.........#..................
.........................#........#........................#.............#..........................#.......................................
..........#..............................#......................#..........................#................................................
#..................................................................................#........................................................
...............................#................................................................................................#...........
.....................................................#.......#.............................................#................................
......#...............#..............#.........#..................#...............................................#......#...............#..")

(defvar *example-input-2*
 *example-input-1*)

(defvar *input-2* *input-1*)
